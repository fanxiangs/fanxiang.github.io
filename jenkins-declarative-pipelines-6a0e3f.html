<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Jenkins: Declarative Pipelines&nbsp;|&nbsp;CookBook</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Jenkins: Declarative Pipelines">
  
    <meta name="description" content="拥抱 Declarative Pipeline ">
    <meta property="og:description" content="拥抱 Declarative Pipeline ">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title">Jenkins: Declarative Pipelines</h1>
    
      <div class="DateTagBar">
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
            <a href="tag/Jenkins.html">Jenkins</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/6a0e3f59f2d54a279287067f982fd6aa" class="PageRoot PageRoot--FullWidth"><ul id="https://www.notion.so/6e5959f715d94c1cb54fcbc77f30c840" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/21d58a9d28344853be62df3e97c0d7f3"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Scripted Pipelines Versus Declarative Pipelines</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/eb9aa8a9bb464a10892540be13965720"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">The Structure</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6bcca8dfd8e6471292b6718eb05b2915"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Block</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6146f70cd3b14cc18520ff7db33f32c6"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Section</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/33eff34dd893489f9701c3f981c26805"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Directives</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/d050a5b7ec5f4e959d3068ad63bc6a47"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Steps</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/60a9f380f69d4b47860e6f7ef6511454"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Conditionals</span></span></div></a></li></ul><div id="https://www.notion.so/869fd7b298444ba38f19cabdb9b0dfc7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Jenkins Declarative Pipeline 是一种以声明方式定义和执行流水线的方法。它是 Jenkins Pipeline 另一个演变，旨在提供一种更简洁、可读性更好的流水线编写方式。</span></span></p></div><div id="https://www.notion.so/38447b896dc04124a5f887b060d4103a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Jenkins Declarative Pipeline 的特点包括：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/efbd3667b5d647d8bd14349fd217a087" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">结构化定义</strong></span><span class="SemanticString">: 流水线由多个阶段（stage）组成，每个阶段包含一个或多个步骤（step）。这种结构化的定义使得流水线更易于组织和管理。</span></span></li><li id="https://www.notion.so/6bfa4fcf8957452d803c5cdb8a698fb6" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">可读性和易维护</strong></span><span class="SemanticString">: 声明性的语法使得流水线脚本更易于阅读和理解。提供了更清晰、更简洁的语法结构，使得流水线的意图更明确，同时减少了冗余和重复的代码。</span></span></li><li id="https://www.notion.so/c55ecfe70013444384639fb3cdbd3fea" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">简单易用</strong></span><span class="SemanticString">：提供界面化表单定义任务的方式创建 pipeline</span></span></li><li id="https://www.notion.so/869c8c3d611644e899b63d98d5bf454f" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">可扩展性</strong></span><span class="SemanticString">: 提供了丰富的插件和内置函数，可以轻松地扩展流水线的功能。可以使用插件来集成其他工具、执行特定的操作，并根据需要自定义流水线的行为。</span></span></li><li id="https://www.notion.so/e95132cd2f4a43099b2c0d0d325519a7" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">可视化和报告</strong></span><span class="SemanticString">: Jenkins 提供了可视化界面来展示和监控流水线的执行过程。可以轻松地查看流水线的状态、日志和报告，以便进行故障排查和性能分析。</span></span></li></ol><h1 id="https://www.notion.so/21d58a9d28344853be62df3e97c0d7f3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/21d58a9d28344853be62df3e97c0d7f3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Scripted Pipelines Versus Declarative Pipelines</strong></strong></span></span></h1><div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><h1 id="https://www.notion.so/eb9aa8a9bb464a10892540be13965720" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/eb9aa8a9bb464a10892540be13965720"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">The Structure</strong></strong></span></span></h1><div id="https://www.notion.so/1c817b9e377b4914b5659aa9182c0a58" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Declarative Pipeline 是由包含指令（directives）和部分（sections）组成的块（block）。 每个部分又可以包含其他部分、指令和步骤，在某些情况下还包含条件。 块、部分和指令之间的区别有些随意，但由于它们出现在官方文档中，所有下面我们将搞清这些术语的定义。</span></span></p></div><h2 id="https://www.notion.so/6bcca8dfd8e6471292b6718eb05b2915" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6bcca8dfd8e6471292b6718eb05b2915"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Block</strong></strong></span></span></h2><div id="https://www.notion.so/9e761c06247d49588e63f1a8d10783b2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Block 是指具有开头结尾的代码集，在 Groovy 中，我们称为 clousre（闭包）。如下所示：</span></span></p></div><pre id="https://www.notion.so/c8ba80adb6f5411896569b51f16b2118" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
 // code in declarative syntax 
}</span></span></span></code></pre><h2 id="https://www.notion.so/6146f70cd3b14cc18520ff7db33f32c6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6146f70cd3b14cc18520ff7db33f32c6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Section</strong></strong></span></span></h2><div id="https://www.notion.so/a47f6b36750843e2902403478ca54851" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">流水线被划分为多个部分（Sections），每个部分定义了特定的功能和行为。</span></span></p></div><div id="https://www.notion.so/a62b8a0f709b4ffc8ff8e4ad3934b548" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Section 可以分为以下几个区域：</span></span></p></div><div id="https://www.notion.so/64774b8e4d5444fba1e71c2cf4abd9a4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">stages：定义了流水线的不同阶段，每个阶段包含一个或多个步骤（steps）。通过在 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">stages</strong></code></span><span class="SemanticString"> 中定义多个阶段，可以将流水线划分为不同的任务，并在需要时并行或串行执行</span></span></p></div><div id="https://www.notion.so/903b67defc8642f3bec02eaadb9337af" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">steps：包含了流水线中的具体步骤，每个步骤定义了一个特定的操作或任务。可以使用内置的步骤（如构建、测试、部署等），也可以使用自定义的脚本步骤来执行更复杂的操作</span></span></p></div><div id="https://www.notion.so/f30746411d8d474d99843960844272cf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">posts：定义了在流水线执行完成后要执行的操作，如发送通知、触发其他任务等。可以定义多个后处理操作，并根据执行结果进行条件判断。</span></span></p></div><pre id="https://www.notion.so/7cf5dc04619d464da43263128e707ba1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
  agent any
  stages { 
     stage(&#x27;name1&#x27;) { 
       steps {      
          ...
       } 
       post {
         ...
       }
     }
     stage(&#x27;name2&#x27;) {
       steps {
          ...
       }
     }
  }
  post {
    ...
  } 
}</span></span></span></code></pre><h2 id="https://www.notion.so/33eff34dd893489f9701c3f981c26805" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/33eff34dd893489f9701c3f981c26805"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Directives</span></span></h2><div id="https://www.notion.so/826e9a5bec5a4ff2b199f0ed46f44f4f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Directive（指令）是一种特殊的语法结构，用于在流水线中指定特定的行为和配置选项。Directives 允许在流水线中进行更细粒度的控制和定制，以满足特定的需求。以下是几个常见的 Directive：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/c83c4a53648a47419f91f23b9dc17386" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Defines values</span></span><div id="https://www.notion.so/e73ba7981a9d4c2faf2ef9e009c0cb64" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">agent</strong></code></span><span class="SemanticString"> ：指定流水线执行所需的运行环境，agent (&#x27;worker&#x27;)。</span></span></p></div></li><li id="https://www.notion.so/d66443cd840945ed96570490cef85cb5" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Configures behavior</span></span><div id="https://www.notion.so/591b2f92dd94459baf32fb3a2d5de580" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">trigger</strong></code></span><span class="SemanticString">：  triggers { cron (&#x27;0 7 0 0 1-5&#x27;) }</span></span></p></div></li><li id="https://www.notion.so/221f716a54e248809e7bc1192b9873ae" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Specifies actions to be done </span></span><div id="https://www.notion.so/ae60e50deadf4a048e0db08db899d26d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">stage</code></span><span class="SemanticString"> ：可以是一个包含要执行 DSL 的 step 。</span></span></p></div></li></ol><h2 id="https://www.notion.so/d050a5b7ec5f4e959d3068ad63bc6a47" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/d050a5b7ec5f4e959d3068ad63bc6a47"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Steps</span></span></h2><div id="https://www.notion.so/0aec27f3a1f3456ca816451c88b330c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Step（步骤）是指在流水线中执行的最小单元操作。每个 Step 执行一个特定的任务或操作，如构建代码、运行测试、部署应用程序等。</span></span></p></div><h2 id="https://www.notion.so/60a9f380f69d4b47860e6f7ef6511454" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/60a9f380f69d4b47860e6f7ef6511454"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Conditionals</span></span></h2><div id="https://www.notion.so/3ae11a9890b84cc181742ebce6815097" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Conditionals 用于根据特定的条件来控制流水线中的执行步骤。可以使用以下几种条件语句：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/ab48103c59734665886bfac6f15347dd" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">when</strong></code></span><span class="SemanticString"> ：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">when</strong></code></span><span class="SemanticString"> 条件用于在流水线中根据特定条件判断是否执行某个阶段。可以根据表达式、环境变量或其他条件来指定执行或跳过阶段。</span></span><pre id="https://www.notion.so/3f797381b30845fe866e6e0ad29d61b2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>stage(&#x27;Build&#x27;) {
    when {
        expression { env.BRANCH_NAME == &#x27;master&#x27; }
    }
    steps {
        // 执行构建步骤
    }
}</span></span></span></code></pre></li><li id="https://www.notion.so/324217df6dc74e4c9a08e688015110df" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"> </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">script</strong></code></span><span class="SemanticString"> ：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">script</strong></code></span><span class="SemanticString"> 条件用于在流水线中执行自定义的 Groovy 脚本，并根据脚本的返回值判断是否执行阶段或步骤。</span></span><pre id="https://www.notion.so/c82266b6249b400eb6f22490c581a963" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>stage(&#x27;Deployment&#x27;) {
    when {
        script {
            return params.DEPLOY_ENV == &#x27;production&#x27;
        }
    }
    steps {
        // 执行部署步骤
    }
}</span></span></span></code></pre></li><li id="https://www.notion.so/4b51ea932e0f4c96998a2befab2bf690" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">environment</strong></code></span><span class="SemanticString"> ：</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">environment</strong></code></span><span class="SemanticString"> 条件用于在流水线中根据环境变量的值判断是否执行特定的阶段或步骤。</span></span><pre id="https://www.notion.so/ec6eb74963b54174a0a06055e9df40d7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>stage(&#x27;Testing&#x27;) {
    when {
        environment name: &#x27;TESTING_ENABLED&#x27;, value: &#x27;true&#x27;
    }
    steps {
        // 执行测试步骤
    }
}</span></span></span></code></pre><h1 id="https://www.notion.so/4bc31236fb674f80932e92408bf6a231" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/4bc31236fb674f80932e92408bf6a231"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">The Building Blocks</strong></strong></span></span></h1><div id="https://www.notion.so/588e18acee5a4458af213390d090e9a1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在本节中，我们将介绍在声明式流水线中每个部分和指令的具体内容，包括语法、参数和示例用法。</span></span></p></div><div id="https://www.notion.so/213084c703de4aa48aa3f9223a1c2580" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">我们从整体来看，这个流水线的构成如图所示。pipeline 是在最外层，所有的指令和结构都在其中。虚框代表可选，实框代表必有。请注意，有一些指令可以不同阶段级别同时出现。它们在一个区域可能是必需的，在另一个区域可能是可选的。</span></span></p></div><div id="https://www.notion.so/bfb8425f7ced42618b0001cd7dbcd1b1" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdf29d01d-4f16-4eb2-b470-161d3f44f482%2Fj2ur_0702.png?width=698&amp;table=block&amp;id=bfb8425f-7ced-4261-8b00-01cd7dbcd1b1"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdf29d01d-4f16-4eb2-b470-161d3f44f482%2Fj2ur_0702.png?width=698&amp;table=block&amp;id=bfb8425f-7ced-4261-8b00-01cd7dbcd1b1" style="width:698px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/677818bb0a92462fa932e565b9cf0fa8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">到目前为止，我们还没有讨论过的指令。 因此，让我们深入了解结构中的每个区域。</span></span></p></div><h2 id="https://www.notion.so/7c3d9d40a15841808d6ec3e3989a1a3a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7c3d9d40a15841808d6ec3e3989a1a3a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">pipeline</strong></strong></span></span></h2><div id="https://www.notion.so/2c904d2a4b9f4e2cb6967bc8a35e582f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">pipeline</strong></code></span><span class="SemanticString"> 是 Declarative Pipeline 的根节点，用于定义整个流水线的开始和结束。它包含了整个流水线的配置信息和阶段定义。</span></span></p></div><h2 id="https://www.notion.so/46b6a71ac55d402895dc5eaf0a835803" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/46b6a71ac55d402895dc5eaf0a835803"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">agent</strong></strong></span></span></h2><div id="https://www.notion.so/6386936b863b425db24e74bd7d51d4e6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">agent</strong></code></span><span class="SemanticString"> 用于指定流水线的运行环境，是必须字段。可以指定使用特定的运行环境，也可以使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">any</strong></code></span><span class="SemanticString"> 表示可以在任何可用的节点上执行。下面是一些关于 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">agent</strong></code></span><span class="SemanticString"> 的详细说明和示例：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/084753169bef4d40b7e2563c664109d7" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"> agent none</span></span><div id="https://www.notion.so/de9ae1245bf5415b91b29d33f5b48fbe" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">当在顶层使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">agent none</strong></code></span><span class="SemanticString"> 时，它表示我们在全局上没有指定一个代理节点用于整个流水线。这意味着如果需要的话，将为每个阶段单独指定一个代理节点。</span></span></p></div><pre id="https://www.notion.so/13afe6904f254870a66b2fbcb1abc4ed" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
    agent none
    
    stages {
        stage(&#x27;Build&#x27;) {
            agent {
                label &#x27;my-build-agent&#x27; // 为 Build 阶段指定特定的代理节点
            }
            steps {
                echo &#x27;Performing build...&#x27;
                // 执行构建操作
            }
        }
        
        stage(&#x27;Test&#x27;) {
            agent {
                label &#x27;my-test-agent&#x27; // 为 Test 阶段指定特定的代理节点
            }
            steps {
                echo &#x27;Performing tests...&#x27;
                // 执行测试操作
            }
        }
        
        // 更多的阶段和步骤...
    }
    // ...
}</span></span></span></code></pre></li><li id="https://www.notion.so/d527a1fa15384afc922c37da3345473c" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">指定 Labels 并自定义 workspace</span></span><pre id="https://www.notion.so/d3f6461181b045f3bbaccfccbca7a021" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
    agent {
        label &quot;&lt;lablename&gt;&quot;
				customWorkspace &quot;&lt;desired directory&gt;&quot;
    }
    // ...
}</span></span></span></code></pre></li><li id="https://www.notion.so/432e4ab141f845149e05b470c066acbb" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Docker Agents</span></span><pre id="https://www.notion.so/815175039ec74685b106c977b935f001" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
    agent {
        docker {
            image &#x27;maven:3.8.3&#x27; // 指定要使用的 Docker 镜像
            label &#x27;docker-agent&#x27; // 指定 Docker Agent 节点的标签或名称
						args &#x27;-v /dir:dir&#x27;  // 指定运行参数
        }
    }
    // ...
}</span></span></span></code></pre></li><li id="https://www.notion.so/59627cdc47c24bddbc9091bbd388dc3c" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">K8S Agents</span></span><pre id="https://www.notion.so/526d158509f148559a5af4951552a804" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
    agent {
        kubernetes {
            // Kubernetes agent 配置选项
            label &#x27;my-k8s-agent&#x27; // 可选：指定要使用的 Kubernetes agent 节点的标签或名称
            yaml &#x27;&#x27;&#x27;
                // Kubernetes Pod 配置
                apiVersion: v1
                kind: Pod
                metadata:
                  name: my-pod
                spec:
                  containers:
                  - name: my-container
                    image: my-image
                    command:
                    - sleep
                    - &#x27;3600&#x27;
            &#x27;&#x27;&#x27;
        }
    }
    // ...
}
</span></span></span></code></pre></li></ol><h2 id="https://www.notion.so/1c4a606c4f9841df8f632ba438ae75c3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/1c4a606c4f9841df8f632ba438ae75c3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">environment</strong></strong></span></span></h2><div id="https://www.notion.so/c0c1d8768f88431180a1737cfa98acc5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">environment</strong></code></span><span class="SemanticString"> 用于定义流水线执行期间的环境变量。可以在全局范围内定义全局环境变量，也可以在特定的阶段或步骤中定义局部环境变量。下面展示如何在流水线中使用：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/a3da8819b7384a028f79bc9c6c9dd5b7" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">定义环境变量</span></span><pre id="https://www.notion.so/786fca60f4734fba9cfe16f21af209f6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>environment {
	TIMEZONE = &quot;eastern&quot;
	TIMEZONE_DS = &quot;${TIMEZONE}_daylight_savings&quot;
}</span></span></span></code></pre></li><li id="https://www.notion.so/d37a4b0a89a547279053fe1ac299b983" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Credentials and environment variables</span></span><pre id="https://www.notion.so/4491897b687b4e9da84f7691b544572b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
    agent any
    
    environment {
        MY_CREDENTIALS = credentials(&#x27;my-credentials-id&#x27;)  // 使用凭据 ID 引用用户名和密码凭据
        API_KEY = credentials(&#x27;api-key-id&#x27;)  // 使用凭据 ID 引用 API 密钥凭据，并指定变量名
    }
    
    stages {
        stage(&#x27;Build&#x27;) {
            steps {
                withCredentials([usernamePassword(credentialsId: env.MY_CREDENTIALS, passwordVariable: &#x27;PASSWORD&#x27;, usernameVariable: &#x27;USERNAME&#x27;)]) {
                    echo &quot;Username: ${env.USERNAME}&quot;
                    echo &quot;Password: ${env.PASSWORD}&quot;
                    // 执行构建操作，可以使用凭据中的用户名和密码
                }
            }
        }
        
        // 更多的阶段和步骤...
    }
    
    post {
        always {
            withCredentials([string(credentialsId: env.API_KEY, variable: &#x27;API_TOKEN&#x27;)]) {
                echo &quot;API Token: ${env.API_TOKEN}&quot;
                
                // 完成操作，可以使用凭据中的 API 密钥
            }
        }
    }
}</span></span></span></code></pre></li></ol><h2 id="https://www.notion.so/a87e1111e4724656b437b8dcbc0e4386" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/a87e1111e4724656b437b8dcbc0e4386"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">tools</strong></strong></span></span></h2><div id="https://www.notion.so/85690e4eee40485ea4cd83b959389376" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">tools</strong></code></span><span class="SemanticString"> 用于指定流水线所需的工具（软件或插件）。通过使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">tools</strong></code></span><span class="SemanticString">，您可以确保流水线在执行期间使用特定版本的工具。以下是一个示例，展示了如何在流水线中使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">tools</strong></code></span><span class="SemanticString">：</span></span></p></div><pre id="https://www.notion.so/80eaad7019304dba9811e18c9f3be814" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
    agent any
    
    tools {
        // 指定工具的名称和版本
        maven &#x27;Maven 3.8.1&#x27;
        jdk &#x27;JDK 11&#x27;
    }
    
    stages {
        stage(&#x27;Build&#x27;) {
            steps {
                // 在 Build 阶段中使用指定版本的工具
                sh &#x27;mvn --version&#x27;
                
                // 执行其他构建操作
            }
        }
        
        // 更多的阶段和步骤...
    }
}</span></span></span></code></pre><h2 id="https://www.notion.so/14ff25b42dfe413abac6be591e06cd9d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/14ff25b42dfe413abac6be591e06cd9d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">options</strong></strong></span></span></h2><div id="https://www.notion.so/367fb828910649cf80e77e5420afb12f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">options</strong></code></span><span class="SemanticString"> 用于配置流水线的选项和全局设置。通过使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">options</strong></code></span><span class="SemanticString">，可以定义流水线的行为、错误处理、并发性等方面的设置。以下是一些常见的选项示例：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/0cfc034968364553b67631ec37f42f5a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">timeout</strong></code></span><span class="SemanticString">：用于设置流水线的超时时间，指定流水线在一段时间内没有完成时应该被中断。</span></span></li><li id="https://www.notion.so/b360018c3f344d3689fc844fa2f8d7a8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">skipDefaultCheckout</strong></code></span><span class="SemanticString">：用于跳过默认的代码检出操作，当您的流水线不需要进行代码检出时使用</span></span></li><li id="https://www.notion.so/4af03435af3b4d23afadd98288e37528" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">disableConcurrentBuilds</strong></code></span><span class="SemanticString">：用于禁止并发构建，确保同一流水线的多个实例不会同时运行</span></span></li><li id="https://www.notion.so/f21cd51a4b50451e8b31397780275fb1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">timestamps</strong></code></span><span class="SemanticString">：用于在流水线日志中显示时间戳，方便跟踪和调试</span></span></li><li id="https://www.notion.so/a79fb3afbb5a489bb9c9a819cec2caab" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">retry</strong></code></span><span class="SemanticString">：用于在步骤或阶段失败时进行重试</span></span></li></ul><div id="https://www.notion.so/f414ece179ee4aab93be7b9ac937596e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">…</span></span></p></div><pre id="https://www.notion.so/4ea36ddaf9c04c4ca078fa6252c5912c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
    agent any
    
    options {
        timeout(time: 1, unit: &#x27;HOURS&#x27;)
        disableConcurrentBuilds()
        timestamps()
    }
    
    stages {
        stage(&#x27;Build&#x27;) {
            options {
                retry(3)
            }
            steps {
                // 执行构建操作
            }
        }
        
        // 更多的阶段和步骤...
    }
}</span></span></span></code></pre><h2 id="https://www.notion.so/7fe764c5c66c4fd58375d6b040ea6d8c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7fe764c5c66c4fd58375d6b040ea6d8c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">triggers</strong></strong></span></span></h2><div id="https://www.notion.so/b84fd67c9ecd4827b732d4f9b905294c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">triggers</strong></code></span><span class="SemanticString"> 用于配置流水线的触发器。触发器定义了触发流水线执行的条件和事件。以下是一些常见的触发器示例：</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/ebd9f99928f04018a8f8a3a91a55f83a" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">cron</strong></code></span><span class="SemanticString"> ：基于 cron 表达式的定时触发器，可以按照指定的时间间隔或特定的时间点触发流水线的执行。示例使用方法如下：</span></span><pre id="https://www.notion.so/162c51001fe2496790a271004686c7b8" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>triggers {
    cron(&#x27;H 0 * * *&#x27;) // 每天凌晨执行
}</span></span></span></code></pre></li><li id="https://www.notion.so/fad68273451e4601a3c85dd30e41c129" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">pollSCM</strong></code></span><span class="SemanticString"> ：用于定期轮询源代码管理系统 (SCM)，当检测到代码变更时触发流水线的执行。示例使用方法如下：</span></span><pre id="https://www.notion.so/b6378e2a42024e0a8641b708a1375767" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>triggers {
    pollSCM(&#x27;H/5 * * * *&#x27;) // 每 5 分钟轮询一次
}</span></span></span></code></pre></li><li id="https://www.notion.so/33181d14ac374220b6fdaf58d7e4a1e5" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">upstream</strong></code></span><span class="SemanticString"> ：当指定的上游流水线完成并成功执行时触发当前流水线的执行。示例使用方法如下：</span></span><pre id="https://www.notion.so/09124bd7fa864d6abc16688b8f4b78d2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>triggers {
    upstream(upstreamProjects: &#x27;my-upstream-pipeline&#x27;, threshold: &#x27;SUCCESS&#x27;)
}</span></span></span></code></pre></li><li id="https://www.notion.so/331d53cd49ce471e983a1d0867fd71b5" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">github</strong></code></span><span class="SemanticString"> ：与 GitHub 代码库集成，当发生 GitHub 事件（例如推送、拉取请求等）时触发流水线的执行。示例使用方法如下：</span></span><pre id="https://www.notion.so/d894f905ae0243f19e8761cab34ca428" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>triggers {
    githubPush()
}</span></span></span></code></pre></li></ol><h3 id="https://www.notion.so/df36a06c5f7e4fdfbdc3861b937735a1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/df36a06c5f7e4fdfbdc3861b937735a1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Cron syntax</span></span></h3><div id="https://www.notion.so/a64110bbe726467da7e1875f8f926c0b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Jenkins 使用 Cron 表达式来配置定时任务的调度。Cron 表达式是一个字符串，由空格分隔的五个或六个字段组成，每个字段表示不同的时间单位和时间范围。下面是 Cron 表达式的基本语法：</span></span></p></div><pre id="https://www.notion.so/f916a9a395544803b812a21b92c5e67b" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>* * * * * *
| | | | | |
| | | | | +-- Year (可选，1970-2099)
| | | | +---- Day of the Week (0-7，Sunday=0或7)
| | | +------ Month (1-12)
| | +-------- Day of the Month (1-31)
| +---------- Hour (0-23)
+------------ Minute (0-59)</span></span></span></code></pre><div id="https://www.notion.so/1c0241a1e8fb4e32b7099d3403ca27a0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">字段值可以是具体的数字，表示特定的时间点或时间单位，也可以是通配符 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">*</strong></code></span><span class="SemanticString"> 表示任意值。此外，还可以使用逗号 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">,</strong></code></span><span class="SemanticString"> 分隔多个值，使用连字符 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">-</strong></code></span><span class="SemanticString"> 指定范围，使用斜杠 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">/</strong></code></span><span class="SemanticString"> 指定步长，以及使用问号 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">?</strong></code></span><span class="SemanticString"> 和星号 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">*</strong></code></span><span class="SemanticString"> 表示任意值。</span></span></p></div><div id="https://www.notion.so/8a4861fca312407c9edebc284fde9234" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">H</strong></code></span><span class="SemanticString"> 是一个特殊的符号，表示“随机值”。当使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">H</strong></code></span><span class="SemanticString"> 作为分钟字段的值时，Jenkins 将选择一个随机的分钟值来执行任务。这样可以减少并发任务在同一时间点上的竞争，提高系统的稳定性和性能。</span></span></p></div><div id="https://www.notion.so/75cf5a8a66da4928b9532454c15d7875" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以下是一些示例：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/7d2be81dcb3f490ba4396ae3aff38b5d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">0 0 * * *</strong></code></span><span class="SemanticString">：每天凌晨零点执行一次</span></span></li><li id="https://www.notion.so/cd831fa6eff74e849f4df3f27e32ef52" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">H 4 * * 1-5</strong></code></span><span class="SemanticString">：每个工作日（星期一至星期五）的上午 4 点随机分钟执行一次</span></span></li><li id="https://www.notion.so/3ab1f8557d8b4d44a110f439bb72cb73" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">0 0 1,15 * *</strong></code></span><span class="SemanticString">：每月的1号和15号的午夜执行一次</span></span></li><li id="https://www.notion.so/0c55ab9700844f318755e8e4ba1fb889" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">0 0 * * 1</strong></code></span><span class="SemanticString">：每个星期一的凌晨执行一次</span></span></li><li id="https://www.notion.so/ddb70955ffd643d0b02ea59f2a899131" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">H * * * *</strong></code></span><span class="SemanticString">：每小时的随机分钟执行一次任务</span></span></li><li id="https://www.notion.so/724c6bbd9b2b47f9a8e9b67ec9d2af2d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">H H(0-7) * * 1-5</strong></code></span><span class="SemanticString">：在每个工作日的随机小时和随机分钟执行任务（小时范围为 0-7）</span></span></li></ul><h2 id="https://www.notion.so/4fc43bf3880c43c5a7d7d3eb45ae0590" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4fc43bf3880c43c5a7d7d3eb45ae0590"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">parameters</strong></strong></span></span></h2><div id="https://www.notion.so/f40e8cd832f34c1e8423e6269363b0e1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">parameters</strong></code></span><span class="SemanticString"> 用来定义流水线参数，以便在流水线执行期间接收用户输入的值。</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/86aedc1e0fd84af6887dc6d67c5e6ae6" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">string</strong></code></span><span class="SemanticString"> 参数：用于接收字符串类型的输入值。</span></span><pre id="https://www.notion.so/642c1d8bf24b4b8eb0d188b5a17dea7c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>parameters {
    string(name: &#x27;ENVIRONMENT&#x27;, defaultValue: &#x27;dev&#x27;, description: &#x27;Environment for deployment&#x27;)
}</span></span></span></code></pre></li><li id="https://www.notion.so/98d61ecabdf445889a1a1379d7781254" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">booleanParam</strong></code></span><span class="SemanticString"> 参数：用于接收布尔类型的输入值。</span></span><pre id="https://www.notion.so/c4fe4858db7c4eb69a4971689eca1e92" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>parameters {
    booleanParam(name: &#x27;ENABLE_TESTS&#x27;, defaultValue: true, description: &#x27;Enable tests&#x27;)
}</span></span></span></code></pre></li><li id="https://www.notion.so/f065f9d5d31d40029c4c49abe1594b7f" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">choice</strong></code></span><span class="SemanticString"> 参数：用于提供一组预定义的选项供用户选择。</span></span><pre id="https://www.notion.so/aaaf72e9f2ca455a9446e21c059ce42c" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>parameters {
    choice(name: &#x27;DATABASE_TYPE&#x27;, choices: [&#x27;MySQL&#x27;, &#x27;PostgreSQL&#x27;, &#x27;Oracle&#x27;], description: &#x27;Select database type&#x27;)
}</span></span></span></code></pre></li><li id="https://www.notion.so/231d378fc1e84c76b970bf09dc3e75d3" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">password</strong></code></span><span class="SemanticString"> 参数：用于接收敏感信息，如密码。</span></span><pre id="https://www.notion.so/b3141bc66a7c4bbeb139a6a307ac2534" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>parameters {
    password(name: &#x27;API_KEY&#x27;, defaultValue: &#x27;&#x27;, description: &#x27;API key&#x27;)
}</span></span></span></code></pre></li><li id="https://www.notion.so/cf284b83b9ac46838656c9c298d52efb" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">file</strong></code></span><span class="SemanticString"> 参数：用于接收文件类型的输入值，用户可以上传文件。</span></span><pre id="https://www.notion.so/037637b6586e409bbd28a8387a8870ff" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>parameters {
    file(name: &#x27;CONFIG_FILE&#x27;, description: &#x27;Upload configuration file&#x27;)
}</span></span></span></code></pre></li></ol><h2 id="https://www.notion.so/eed0b0f2a9db430c8ee91ceb94a647fe" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/eed0b0f2a9db430c8ee91ceb94a647fe"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">libraries</span></span></h2><div id="https://www.notion.so/7a1f288ff1dd4510b86dd3ff7f31746f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Jenkins Declarative Pipeline 允许您使用共享库（libraries）来重用和组织流水线中的代码逻辑。</span></span></p></div><div id="https://www.notion.so/c40427721de845b9b1592668544cc4b3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以通过以下形式加载 libraries：</span></span></p></div><pre id="https://www.notion.so/a1a4b7343c414f4d97e79ea9269ec504" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
     agent any
     libraries {
        lib(&quot;mylib@master&quot;)
        lib(&quot;alib&quot;)
    }
    stages {
       ...</span></span></span></code></pre><div id="https://www.notion.so/92a343e761d24c4ca281a304fb658cfa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在后面我们对 shared libraries 进行详细阐述。</span></span></p></div><h2 id="https://www.notion.so/18bda65e3b1149f690d82647a30f5670" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/18bda65e3b1149f690d82647a30f5670"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">stages</span></span></h2><div id="https://www.notion.so/c3e032f6fbb44041811884ad7f31b2c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">stages</strong></code></span><span class="SemanticString"> 段落用于定义流水线的各个阶段。流水线的执行被划分为多个阶段，每个阶段包含一个或多个步骤（</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">steps</strong></code></span><span class="SemanticString">）来执行特定的任务。</span></span></p></div><h3 id="https://www.notion.so/e729fd5296c04f03aac900500e22e8d8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e729fd5296c04f03aac900500e22e8d8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">stage</span></span></h3><div id="https://www.notion.so/b1e3bd789c1a40109be2abcbc7280236" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">stage</strong></code></span><span class="SemanticString"> 是用于定义流水线中单个阶段的关键字。每个 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">stage</strong></code></span><span class="SemanticString"> 代表流水线的一个执行阶段，用于将任务划分为逻辑上的阶段。</span></span></p></div><h3 id="https://www.notion.so/98aa974c61414ef48f7de40d80e7490a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/98aa974c61414ef48f7de40d80e7490a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">steps</span></span></h3><div id="https://www.notion.so/23da80963f6541f2a9ec406231b83b78" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">steps</strong></code></span><span class="SemanticString"> 是用于定义流水线中执行任务的关键字。</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">steps</strong></code></span><span class="SemanticString"> 段落用于包含一系列步骤，每个步骤代表流水线中的一个执行动作或命令。</span></span></p></div><div id="https://www.notion.so/5ed83f66c0e2421a965e5a10356fb650" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">每个步骤可以是任何有效的 DSL 语句，例如 echo、archiveArtifacts、git、mail 等。在这个级别上，DSL 语句的语法在 Scripted Pipeline 和 Declarative Pipeline 中是相同的。然而，您不能使用 Groovy 的非 DSL 语句或结构，例如 if-then 或赋值语句。</span></span></p></div><pre id="https://www.notion.so/bb954e08a17e437dbc50782e0e36b032" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>steps {
    &lt;individual steps - i.e., DSL statements&gt;
}
// example
steps {
    echo &#x27;This is a message&#x27; // 打印消息
    archiveArtifacts &#x27;build/**/*.jar&#x27; // 归档构件
    git branch: &#x27;master&#x27;, url: &#x27;https://github.com/user/repo.git&#x27; // 执行 Git 操作
    mail to: &#x27;example@example.com&#x27;, subject: &#x27;Build Notification&#x27;, body: &#x27;Build successful&#x27; // 发送电子邮件
}</span></span></span></code></pre><h3 id="https://www.notion.so/38b1dd1f8f6e4c719bfcb78d815562fa" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/38b1dd1f8f6e4c719bfcb78d815562fa"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">when</span></span></h3><div id="https://www.notion.so/87fe33eb370942b29e0c3b7db215769f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">when</strong></code></span><span class="SemanticString"> 指令基于特定条件来控制阶段的执行与否。</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">when</strong></code></span><span class="SemanticString"> 指令允许您指定一个条件，以决定是否执行或跳过该阶段。</span></span></p></div><pre id="https://www.notion.so/5352a7286a424c17b98d31b47d798926" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>stage(&#x27;Test&#x27;) {
    when {
        expression { currentBuild.result == &#x27;SUCCESS&#x27; }  // 仅在 &#x27;Build&#x27; 阶段成功时执行该阶段
    }
    steps {
        // 测试步骤
    }
}</span></span></span></code></pre><div id="https://www.notion.so/43c71ac7e4284ee7b78a75008a25116b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">可以使用逻辑运算符 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">and</strong></code></span><span class="SemanticString">、</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">or</strong></code></span><span class="SemanticString"> 和 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">not</strong></code></span><span class="SemanticString"> 来组合条件，实现更复杂的条件执行。</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/4443c9bd2348418ab15f8365da48b04e" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">and</strong></code></span><span class="SemanticString"> 运算符</span></span><pre id="https://www.notion.so/66ca5ff6d6c3430aacb14089805732bf" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>stage(&#x27;Build and Test&#x27;) {
    when {
        // 仅在 &#x27;Build&#x27; 和 &#x27;Test&#x27; 阶段都成功时执行该阶段
        allOf {
            expression { currentBuild.getBuild(&#x27;Build&#x27;).result == &#x27;SUCCESS&#x27; }
            expression { currentBuild.getBuild(&#x27;Test&#x27;).result == &#x27;SUCCESS&#x27; }
        }
    }
    steps {
        // 构建和测试步骤
    }
}</span></span></span></code></pre></li><li id="https://www.notion.so/6b972dad9f9f420f8aa0be1a855c1ad9" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">or</strong></code></span><span class="SemanticString"> 运算符</span></span><pre id="https://www.notion.so/e0aae8d31e5d423eaf80af9afdf0760d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>stage(&#x27;Deploy or Promote&#x27;) {
    when {
        // 仅在 &#x27;Deploy&#x27; 或 &#x27;Promote&#x27; 阶段至少一个成功时执行该阶段
        anyOf {
            expression { currentBuild.getBuild(&#x27;Deploy&#x27;).result == &#x27;SUCCESS&#x27; }
            expression { currentBuild.getBuild(&#x27;Promote&#x27;).result == &#x27;SUCCESS&#x27; }
        }
    }
    steps {
        // 部署或促销步骤
    }
}</span></span></span></code></pre></li><li id="https://www.notion.so/a02ef87395ba41d38897df33487752a1" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">not</strong></code></span><span class="SemanticString"> 运算符</span></span><pre id="https://www.notion.so/47a8b27e9e2d440eac2b19f5edae6584" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>stage(&#x27;Build if Not Skipped&#x27;) {
    when {
        // 仅在 &#x27;Build&#x27; 阶段没有被跳过时执行该阶段
        not {
            expression { currentBuild.getBuild(&#x27;Build&#x27;).result == &#x27;SKIPPED&#x27; }
        }
    }
    steps {
        // 构建步骤
    }
}</span></span></span></code></pre></li></ol><div id="https://www.notion.so/78624c2763cf40698f35e628d54618c1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/a3ae5da7243240508fcfb5f9f3e9997e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">每个 stages 可以有单独的 post 方法，下面我们将会详细说明。</span></span></p></div><h2 id="https://www.notion.so/7106313750ac4af9a6fb8c8b7fc6bdf6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7106313750ac4af9a6fb8c8b7fc6bdf6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">post</span></span></h2><div id="https://www.notion.so/77d251770f784e7c9f23809ee9ad8616" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">post</strong></code></span><span class="SemanticString"> 是一个用于定义在流水线执行完成后执行的步骤或操作的指令。它允许您指定不同的后续处理步骤，无论流水线执行成功还是失败。</span></span></p></div><div id="https://www.notion.so/2693122b7cea4cccb5a669eccacdf2e4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">post</strong></code></span><span class="SemanticString"> 指令可以包含多个子指令，每个子指令定义了特定的后续处理操作。常用的子指令包括：</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/43e1811221374687aea48508d1dc4dc3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">always</strong></code></span><span class="SemanticString">：无论流水线执行结果如何，都会执行的步骤。</span></span></li><li id="https://www.notion.so/4f66424e73dd4c3fb4453b23e9c49783" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">success</strong></code></span><span class="SemanticString">：仅在流水线执行成功时执行的步骤。</span></span></li><li id="https://www.notion.so/329addbff3cf42688b30bf9c1e9acae4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">failure</strong></code></span><span class="SemanticString">：仅在流水线执行失败时执行的步骤。</span></span></li><li id="https://www.notion.so/246456c6a00f41d2836f0bb7dcdc2139" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">changed</strong></code></span><span class="SemanticString">：仅在流水线执行结果发生变化时执行的步骤。</span></span></li><li id="https://www.notion.so/f44f292806b64df19017867b3d6bc97c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">unstable</strong></code></span><span class="SemanticString">：仅在流水线执行结果为不稳定时执行的步骤。</span></span></li></ul><pre id="https://www.notion.so/c8f13637548945c49fc72cad3b9c2d9f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
    agent any
    stages {
        // 定义流水线阶段
    }
    post {
        always {
            // 在流水线执行完成后始终执行的步骤
            echo &quot;Pipeline completed&quot;
        }
        success {
            // 仅在流水线执行成功时执行的步骤
            echo &quot;Pipeline succeeded&quot;
        }
        failure {
            // 仅在流水线执行失败时执行的步骤
            echo &quot;Pipeline failed&quot;
        }
        changed {
            // 仅在流水线执行结果发生变化时执行的步骤
            echo &quot;Pipeline result changed&quot;
        }
        unstable {
            // 仅在流水线执行结果为不稳定时执行的步骤
            echo &quot;Pipeline unstable&quot;
        }
    }
}</span></span></span></code></pre><div id="https://www.notion.so/cccb1b9ffec944faabede92d3d11d3f8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></li></ol></article>
  <script src="https://utteranc.es/client.js"
        repo="fanxiangs/fanxiangs.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
  <footer class="Footer">
  <div>&copy; CookBook 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>