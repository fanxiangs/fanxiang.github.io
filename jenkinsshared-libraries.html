<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Extending with Shared Libraries&nbsp;|&nbsp;CookBook</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Extending with Shared Libraries">
  
    <meta name="description" content="This document provides a comprehensive guide to using shared libraries in Jenkins. It covers the differences between trusted and untrusted libraries, and how to load and use libraries in your pipelines. It also includes information on defining global variables and custom steps, and troubleshooting tips.">
    <meta property="og:description" content="This document provides a comprehensive guide to using shared libraries in Jenkins. It covers the differences between trusted and untrusted libraries, and how to load and use libraries in your pipelines. It also includes information on defining global variables and custom steps, and troubleshooting tips.">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="jenkins-book.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.jenkins.io/images/logos/jenkins/jenkins.png"></span>&nbsp;
          
          <span>Jenkins Book</span>
        </div>
      </a>
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title">Extending with Shared Libraries</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Tue, Jun 20, 2023</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
            <a href="tag/Jenkins.html">Jenkins</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--default">
            <a href="tag/CI.html">CI</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/6e0c6106fb1b41eb8b5c8f25f3cbc980" class="PageRoot"><ul id="https://www.notion.so/5e6b53da50394288bd77b4122f254764" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/0610d2439b15432990a2cdb3899b1bc5"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Defining Shared Libraries</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/42cec65e1ff0472290d93d39ea7c514e"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Trusted Versus Untrusted Libraries</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0260f83ea7e9499388f9a9bf0af4279e"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Internal Versus External Libraries</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/acd4d22c1a174de8bfccf6b0a218a0eb"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Library Scope Within Jenkins Items</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/bd62ca9650984447937d62e24c3ea1f0"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Using Libraries</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/fcb865a028da481d82d1256ff8675da4"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Loading Libraries</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b57571b6a3bd427589aeab9b9df8c9a2"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">@Library syntax:</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/4588fe81f15c4daab037b99b2d2712c2"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">The libraries directive</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/245d44cb68884b4f9edb80d94cfddc0c"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Writing libraries</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/95df3c060d0b474eab1f5efc69ef0cf1"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">Library Structure</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/7a51775137ad4ce08dfec51e36b92750"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">src</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f9e5919fcc354cad8016f5f1c93b1428"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">vars</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6cd5c20eca0047839781c9a698f44607"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Defining global variables</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/91f53939b44849f9837bb90611c07c40"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Defining custom steps</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b9d657ffa17b4998b66fd077cb6bab07"><div style="margin-left:72px"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Defining a more structured DSL</strong></strong></span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f5014d4075f54418893624d52886e2b3"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">resources</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/446093c6ac354e5dac6ed07875b679fc"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">Using Third-Party Libraries</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/f407e1968fd94d6e837cf7945b3cd675"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Troubleshooting</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/b3eed7e34b2b48d28b6226dab688fe51"><div style="margin-left:48px"><span class="SemanticStringArray"><span class="SemanticString">Replaying External Code and Libraries</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/0cff9ec0f3fe4c7ca6822a60cd2d9e94"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Sample Library Routine</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/062009fb3ee14c9b8139615d89ecc35c"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Summary</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/6a51ad6ec6944b6295c955d39fc8a731"><div style="margin-left:24px"><span class="SemanticStringArray"><span class="SemanticString">Reference</span></span></div></a></li></ul><h1 id="https://www.notion.so/0610d2439b15432990a2cdb3899b1bc5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/0610d2439b15432990a2cdb3899b1bc5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Defining Shared Libraries</strong></strong></span></span></h1><h2 id="https://www.notion.so/42cec65e1ff0472290d93d39ea7c514e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/42cec65e1ff0472290d93d39ea7c514e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Trusted Versus Untrusted Libraries</span></span></h2><div id="https://www.notion.so/eb027e0bdf894a70a087f118162e2dae" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Trusted Libraries, with high execution rights and security. This type of library can execute arbitrary Groovy code, can reference external dependencies and tools, and can use a version control system to manage the code and version of the library, which can be used to perform sensitive operations and access restricted resources.</span></span></p></div><div id="https://www.notion.so/b2b22fe003c34c9a8fbbea41fd0745cf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Untrusted Libraries are relatively insecure. This type of library can only execute restricted Groovy code, can only use the steps and functions provided by Jenkins, and cannot reference external dependencies and tools.Untrusted Libraries are relatively insecure. This type of library can only execute restricted Groovy code, can only use the steps and functions provided by Jenkins, and cannot reference external dependencies and tools.</span></span></p></div><div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><h2 id="https://www.notion.so/0260f83ea7e9499388f9a9bf0af4279e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/0260f83ea7e9499388f9a9bf0af4279e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Internal Versus External Libraries</span></span></h2><h2 id="https://www.notion.so/acd4d22c1a174de8bfccf6b0a218a0eb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/acd4d22c1a174de8bfccf6b0a218a0eb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Library Scope Within Jenkins Items</span></span></h2><div id="https://www.notion.so/cf6889f61fbd4f919d7760490f0f4fa1" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0ef7e2c5-68ce-4e8f-9452-147937c4b147%2FUntitled.png?width=1170&amp;table=block&amp;id=cf6889f6-1fbd-4f91-9d77-60490f0f4fa1"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0ef7e2c5-68ce-4e8f-9452-147937c4b147%2FUntitled.png?width=1170&amp;table=block&amp;id=cf6889f6-1fbd-4f91-9d77-60490f0f4fa1" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h1 id="https://www.notion.so/bd62ca9650984447937d62e24c3ea1f0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/bd62ca9650984447937d62e24c3ea1f0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Using Libraries</span></span></h1><h2 id="https://www.notion.so/fcb865a028da481d82d1256ff8675da4" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/fcb865a028da481d82d1256ff8675da4"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Loading Libraries</span></span></h2><div id="https://www.notion.so/64f63c9cbf334bd5afea6875d6eef5a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Load implicitly: If checked, scripts will automatically have access to this library without needing to request it via </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">@Library</code></span><span class="SemanticString">.</span></span></p></div><h3 id="https://www.notion.so/b57571b6a3bd427589aeab9b9df8c9a2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b57571b6a3bd427589aeab9b9df8c9a2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">@Library syntax:</span></span></h3><div id="https://www.notion.so/cf9bde0ab78049e8b3deab0e1da44b30" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">@Library(&#x27;&lt;libname&gt;[@&lt;version&gt;]&#x27;)_ [&lt;import statement&gt;]</code></span><span class="SemanticString"></span></span></p></div><div id="https://www.notion.so/67a43b37fd164d66826a6c40a2689850" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">A couple of points about the syntax:</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/5f8077d506dc4b4998a9bec4c570cde8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">The library name is required.</span></span></li><li id="https://www.notion.so/ef3c8f77ac7c4fcfbc32d7fcfa174a34" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">The version should be preceded by the @ sign.</span></span></li><li id="https://www.notion.so/04a765e825104d8c8e75d0a0e67daaa8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">The version can be a tag, branch name, or other specification of a revision in the source code repository.</span></span></li><li id="https://www.notion.so/a86b50bbd238499b8d3345fe70d3f254" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Specific subsets of methods can be imported by including an </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">import</code></span><span class="SemanticString"> statement at the end of the annotation or on the next line.</span></span></li><li id="https://www.notion.so/30d015179a244e33b5a1f4f7dc082ab5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">An </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">import</code></span><span class="SemanticString"> statement is not required. If one is not specified, all methods will be imported.</span></span></li><li id="https://www.notion.so/0906b4e8945d41578a687423bb8116a1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">If no </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">import</code></span><span class="SemanticString"> statement is specified, then an underscore (</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">_</code></span><span class="SemanticString">) </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">must</em></span><span class="SemanticString"> be placed at the end of the annotation, directly after the closing parenthesis. (This is required since an annotation needs something to annotate by definition. In this case, the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">_</code></span><span class="SemanticString"> is simply serving as a placeholder.)</span></span></li><li id="https://www.notion.so/e2a6b33001254921bb1d234448c9520c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Multiple library names (with respective versions if desired) can be specified in the same annotation. Just separate them with commas.</span></span></li></ul><div id="https://www.notion.so/d8393b02ebd14178a0fdbc29f47dc01c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here are some simple examples:</span></span></p></div><pre id="https://www.notion.so/4343b4cc4e724cffb47d559c2c0398ef" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>// Load the default version of a library
@Library(&#x27;myLib&#x27;)_

// Override the default version and load a specific version of a library
@Library(&#x27;yourLib@2.0&#x27;)_

// Accessing multiple libraries with one statement
@Library([&#x27;myLib&#x27;, &#x27;yourLib@master&#x27;])_

// Annotation with import
@Library(&#x27;myLib@1.0&#x27;) import static org.demo.Utilities.*</span></span></span></code></pre><h3 id="https://www.notion.so/4588fe81f15c4daab037b99b2d2712c2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4588fe81f15c4daab037b99b2d2712c2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">The libraries directive</span></span></h3><div id="https://www.notion.so/e967964e500447c6b9f3c37259f5b716" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Within a Declarative Pipeline, we have one other option for pulling in libraries.</span></span></p></div><pre id="https://www.notion.so/a807c8d3dd7c447aab86f6b66f439135" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pipeline {
     agent any
     libraries {
        lib(&quot;mylib@master&quot;)
        lib(&quot;alib&quot;)
    }</span></span></span></code></pre><h1 id="https://www.notion.so/245d44cb68884b4f9edb80d94cfddc0c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/245d44cb68884b4f9edb80d94cfddc0c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Writing libraries</strong></strong></span></span></h1><h2 id="https://www.notion.so/95df3c060d0b474eab1f5efc69ef0cf1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/95df3c060d0b474eab1f5efc69ef0cf1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Library Structure</span></span></h2><pre id="https://www.notion.so/84d1e160a5e14dab88d8e58adb9571b6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>(root)
+- src                     # Groovy source files
|   +- org
|       +- foo
|           +- Bar.groovy  # for org.foo.Bar class
+- vars
|   +- foo.groovy          # for global &#x27;foo&#x27; variable
|   +- foo.txt             # help for &#x27;foo&#x27; variable
+- resources               # resource files (external libraries only)
|   +- org
|       +- foo
|           +- bar.json    # static helper data for org.foo.Bar</span></span></span></code></pre><h2 id="https://www.notion.so/7a51775137ad4ce08dfec51e36b92750" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7a51775137ad4ce08dfec51e36b92750"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">src</span></span></h2><div id="https://www.notion.so/462d2948d4d348e7b903ade0769fd099" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">src</code></span><span class="SemanticString"> directory should look like standard Java source directory structure. This directory is added to the classpath when executing Pipelines.</span></span></p></div><div id="https://www.notion.so/4eba9e8cf1484e7cb49610e2bcd4401b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Any Groovy code is valid to use here. However, in most cases, you’ll probably want to invoke some kind of pipeline processing, using actual pipeline steps. There are several options for how to implement the step calls within the library, and correspondingly, how to invoke them from the script.</span></span></p></div><div id="https://www.notion.so/d4c3431146a447e6b734cbbcab008830" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here are some examples of things you could have in the </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">src</em></span><span class="SemanticString"> area:</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/6a33f33e020a4af7aac35ce24ab86421" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Library classes cannot directly call steps such as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sh</code></span><span class="SemanticString"> or </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">git</code></span><span class="SemanticString">. They can however implement methods, outside of the scope of an enclosing class, which in turn invoke Pipeline steps, for example:</span></span><pre id="https://www.notion.so/aae15770561847e593c397592d5d57a7" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>// src/org/foo/Zot.groovy
package org.foo

def checkOutFrom(repo) {
  git url: &quot;git@github.com:jenkinsci/${repo}&quot;
}

return this</span></span></span></code></pre><div id="https://www.notion.so/e0fb427ab89447f2a64895c57a8b6894" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Which can then be called from a Scripted Pipeline:</span></span></p></div><pre id="https://www.notion.so/8547e84fab124663807f0628d11fcf21" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>def z = new org.foo.Zot()
z.checkOutFrom(repo)</span></span></span></code></pre><div id="https://www.notion.so/1bafbf5d2889433b86d62d9bf38be0a8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">This approach has limitations; for example, it prevents the declaration of a superclass.</span></span></p></div></li><li id="https://www.notion.so/d40ed5cfae43485ea39e94c136ef958b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Alternately, a set of DSL </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">steps</code></span><span class="SemanticString"> can be passed explicitly using </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">this</code></span><span class="SemanticString"> to a library class, in a constructor, or just one method:</span></span><pre id="https://www.notion.so/275e09a27751400291bdd0063647a11e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package org.foo
class Utilities implements Serializable {
  def steps
  Utilities(steps) {this.steps = steps}
  def mvn(args) {
    steps.sh &quot;${steps.tool &#x27;Maven&#x27;}/bin/mvn -o ${args}&quot;
  }
}</span></span></span></code></pre><div id="https://www.notion.so/abacd75261ca48e8a2296c0358f7514b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">When saving state on classes, such as above, the class </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">must</strong></span><span class="SemanticString"> implement the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Serializable</code></span><span class="SemanticString"> interface. This ensures that a Pipeline using the class, as seen in the example below, can properly suspend and resume in Jenkins.</span></span></p></div><pre id="https://www.notion.so/d574f34e307e47bfa55690efd2d99265" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>@Library(&#x27;utils&#x27;) import org.foo.Utilities
def utils = new Utilities(this)
node {
  utils.mvn &#x27;clean package&#x27;
}</span></span></span></code></pre><div id="https://www.notion.so/eafbd811d0554460b923367041183995" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">If the library needs to access global variables, such as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">env</code></span><span class="SemanticString">, those should be explicitly passed into the library classes, or methods, in a similar manner.</span></span></p></div><pre id="https://www.notion.so/a87c9c79da1c4ed2bb06130e4a2513b1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package org.foo
class Utilities implements Serializable {
  def steps
	def env
  Utilities(steps, env) {
		this.steps = steps
		this.env = env
	}
  def mvn(args) {
    steps.sh &quot;${steps.tool &#x27;Maven&#x27;}/bin/mvn -o ${args}&quot;
		steps.sh &quot;echo Building for ${env.BUILD_TAG}&quot;
  }
}</span></span></span></code></pre></li><li id="https://www.notion.so/3da8b938c7fe49838879530e995cdc01" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Instead of passing numerous variables from the Scripted Pipeline into a library:</span></span><pre id="https://www.notion.so/bdeccece13714462b253a5621d755f91" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package org.foo
class Utilities {
  static def mvn(script, args) {
    script.sh &quot;${script.tool &#x27;Maven&#x27;}/bin/mvn -s ${script.env.HOME}/jenkins.xml -o ${args}&quot;
  }
}</span></span></span></code></pre><div id="https://www.notion.so/638b82f0c68643c3930b7af301f62165" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The above example shows the script being passed in to one </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">static</code></span><span class="SemanticString"> method, invoked from a Scripted Pipeline as follows:</span></span></p></div><pre id="https://www.notion.so/265f2668bc84483c913bf62656a98019" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>@Library(&#x27;utils&#x27;) import static org.foo.Utilities.*
node {
  mvn this, &#x27;clean package&#x27;
}</span></span></span></code></pre></li></ul><h2 id="https://www.notion.so/f9e5919fcc354cad8016f5f1c93b1428" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f9e5919fcc354cad8016f5f1c93b1428"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">vars</span></span></h2><div id="https://www.notion.so/2ac83dfa9ff24634b9457eeae127bfb7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">vars</code></span><span class="SemanticString"> directory hosts script files that are exposed as a variable in Pipelines. The name of the file is the name of the variable in the Pipeline. </span></span></p></div><div id="https://www.notion.so/9747f9138bd9427794c3e17086b0b9c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The basename of each </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.groovy</code></span><span class="SemanticString"> file should be a Groovy (~ Java) identifier, conventionally </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">camelCased</code></span><span class="SemanticString">. The matching </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.txt</code></span><span class="SemanticString">, if present, can contain documentation, processed through the system’s configured </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://wiki.jenkins.io/display/JENKINS/Markup+formatting">markup formatter</a></span><span class="SemanticString"> (so may really be HTML, Markdown, etc., though the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.txt</code></span><span class="SemanticString"> extension is required). This documentation will only be visible on the </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.jenkins.io/doc/book/pipeline/getting-started/#global-variable-reference">Global Variable Reference</a></span><span class="SemanticString"> pages that are accessed from the navigation sidebar of Pipeline jobs that import the shared library. In addition, those jobs must run successfully once before the shared library documentation will be generated.</span></span></p></div><div id="https://www.notion.so/48fb463b72a94081bb41b6abdd9ae19f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The Groovy source files in these directories get the same “CPS transformation” as in Scripted Pipeline.</span></span></p></div><h3 id="https://www.notion.so/6cd5c20eca0047839781c9a698f44607" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/6cd5c20eca0047839781c9a698f44607"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Defining global variables</strong></strong></span></span></h3><div id="https://www.notion.so/a5b0e8f8279f496e909bed207a38d949" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Internally, scripts in the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">vars</code></span><span class="SemanticString"> directory are instantiated on-demand as singletons. This allows multiple methods to be defined in a single </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">.groovy</code></span><span class="SemanticString"> file for convenience. For example:</span></span></p></div><pre id="https://www.notion.so/9ed509ee99654e93b269328d5211ea55" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>def info(message) {
    echo &quot;INFO: ${message}&quot;
}

def warning(message) {
    echo &quot;WARNING: ${message}&quot;
}</span></span></span></code></pre><pre id="https://www.notion.so/dbe7cfd15a714ea0b4e96edc99acdb63" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>@Library(&#x27;utils&#x27;) _

log.info &#x27;Starting&#x27;
log.warning &#x27;Nothing to do!&#x27;</span></strong></span></span></code></pre><div id="https://www.notion.so/a877a0186c2343669cfd14f85a39da99" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Declarative Pipeline does not allow method calls on objects outside &quot;script&quot; blocks. (</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://issues.jenkins.io/browse/JENKINS-42360">JENKINS-42360</a></span><span class="SemanticString">). The method calls above would need to be put inside a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">script</code></span><span class="SemanticString"> directive:</span></span></p></div><pre id="https://www.notion.so/5433e75acf4745a08b385b3fa6906527" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>@Library(&#x27;utils&#x27;) _

pipeline {
    agent none
    stages {
        stage (&#x27;Example&#x27;) {
            steps {
                // log.info &#x27;Starting&#x27;
                script {
                    log.info &#x27;Starting&#x27;
                    log.warning &#x27;Nothing to do!&#x27;
                }
            }
        }
    }
}</span></span></span></code></pre><h3 id="https://www.notion.so/91f53939b44849f9837bb90611c07c40" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/91f53939b44849f9837bb90611c07c40"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Defining custom steps</strong></strong></span></span></h3><div id="https://www.notion.so/a132e35a63ed4ae69b7c87fe66af188d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Shared Libraries can also define global variables which behave similarly to built-in steps, such as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sh</code></span><span class="SemanticString"> or </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">git</code></span><span class="SemanticString">. Global variables defined in Shared Libraries </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">must</strong></span><span class="SemanticString"> be named with all lowercase or &quot;camelCased&quot; in order to be loaded properly by Pipeline.</span></span></p></div><div id="https://www.notion.so/09b9629df8a044f59f796a79f63db6e9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">For example, to define </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">sayHello</code></span><span class="SemanticString">, the file </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">vars/sayHello.groovy</code></span><span class="SemanticString"> should be created and should implement a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">call</code></span><span class="SemanticString"> method. The </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">call</code></span><span class="SemanticString"> method allows the global variable to be invoked in a manner similar to a step:</span></span></p></div><pre id="https://www.notion.so/6e724c531cc6400f83f4ce6530bec025" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>def call(String name = &#x27;human&#x27;) {
    // Any valid steps can be called from this code, just like in other
    // Scripted Pipeline
    echo &quot;Hello, ${name}.&quot;
}</span></span></span></code></pre><div id="https://www.notion.so/ca00b68968ee427f816ba0f510a13856" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The Pipeline would then be able to reference and invoke this variable:</span></span></p></div><pre id="https://www.notion.so/15b132e4e5c340168a6ca5ce9ded34f6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>sayHello &#x27;Joe&#x27;
sayHello() /* invoke with default arguments */</span></span></span></code></pre><div id="https://www.notion.so/209b277fc4f14904b1065d3b0eb8d5f6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">If called with a block, the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">call</code></span><span class="SemanticString"> method will receive a </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://groovy-lang.org/closures.html"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Closure</code></a></span><span class="SemanticString">. The type should be defined explicitly to clarify the intent of the step, for example:</span></span></p></div><pre id="https://www.notion.so/4fa5fed107d84f01840060355aa832c8" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>def call(Closure body) {
    node(&#x27;windows&#x27;) {
        body()
    }
}</span></span></span></code></pre><div id="https://www.notion.so/8e601428a78245fda5fea17969aa9c84" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The Pipeline can then use this variable like any built-in step which accepts a block:</span></span></p></div><pre id="https://www.notion.so/bc1940e6c2534e3cb316d1b1867430d2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>windows {
    bat &quot;cmd /?&quot;
}</span></span></span></code></pre><h3 id="https://www.notion.so/b9d657ffa17b4998b66fd077cb6bab07" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/b9d657ffa17b4998b66fd077cb6bab07"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Defining a more structured DSL</strong></strong></span></span></h3><div id="https://www.notion.so/f0ee1ed087e44e759dc8de9b056b3f47" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">If you have a lot of Pipelines that are mostly similar, the global variable mechanism provides a handy tool to build a higher-level DSL that captures the similarity. For example, all Jenkins plugins are built and tested in the same way, so we might write a step named </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">buildPlugin</code></span><span class="SemanticString">:</span></span></p></div><pre id="https://www.notion.so/a8e25c5dde5045c686f40ad2860b61e0" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>def call(Map config) {
    node {
        git url: &quot;https://github.com/jenkinsci/${config.name}-plugin.git&quot;
        sh &#x27;mvn install&#x27;
        mail to: &#x27;...&#x27;, subject: &quot;${config.name} plugin build&quot;, body: &#x27;...&#x27;
    }
}</span></span></span></code></pre><div id="https://www.notion.so/360eb6d30f9c43e0922c280c6fcc421c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Assuming the script has either been loaded as a </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.jenkins.io/doc/book/pipeline/shared-libraries/#global-shared-libraries">Global Shared Library</a></span><span class="SemanticString"> or as a </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.jenkins.io/doc/book/pipeline/shared-libraries/#folder-level-shared-libraries">Folder-level Shared Library</a></span><span class="SemanticString"> the resulting </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Jenkinsfile</code></span><span class="SemanticString"> will be dramatically simpler:</span></span></p></div><pre id="https://www.notion.so/9ed13b68e1694cb1806138e88ee4b110" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>buildPlugin name: &#x27;git&#x27;</span></span></span></code></pre><div id="https://www.notion.so/86f67d75fcef46db903b365473beacff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">There is also a “builder pattern” trick using Groovy’s </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Closure.DELEGATE_FIRST</code></span><span class="SemanticString">, which permits </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Jenkinsfile</code></span><span class="SemanticString"> to look slightly more like a configuration file than a program, but this is more complex and error-prone and is not recommended.</span></span></p></div><pre id="https://www.notion.so/d0705af86e9a4db08ddf11ae83959527" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>def call(body) {
    // collect assignments passed in into our mapping
    def settings = [:]
    body.resolveStrategy = Closure.DELEGATE_FIRST
    body.delegate = settings
    body()

    // now, time the commands
   timestamps {
      cmdOutput = echo sh (script:&quot;${settings.cmd}&quot;, returnStdout:true).trim()
   }
   echo cmdOutput
   writeFile file: &#x27;${settings.logFilePath}&#x27;, text: &#x27;${cmdOutput}&#x27;
}</span></span></span></code></pre><div id="https://www.notion.so/457d71cf13754308a05208783797bb0c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">In this form, we declare a Groovy map via the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">def settings = [:]</code></span><span class="SemanticString"> syntax. Then the values we pass in get mapped and we can execute whatever other steps we need to. The</span><span class="SemanticString"> references to </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">delegate</code></span><span class="SemanticString"> here have to do with Groovy functionality. A complete discussion of delegation behavior in Groovy is beyond the scope of this section, but you can essentially think of it as telling Groovy to allow us to reference any values passed in utilizing the mapping we’re doing in this function.</span></span></p></div><div id="https://www.notion.so/062b4da989aa4d99b6ec90fa1336d229" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Note that here, as in other </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">vars</em></span><span class="SemanticString"> steps, you should only use valid pipeline steps. Non-step Groovy code may not work or may have uncertain behavior.</span></span></p></div><div id="https://www.notion.so/884915becbe847ceb79e5dece9caea2f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">With this form, we can invoke the code from our pipeline script very simply, as shown here:</span></span></p></div><pre id="https://www.notion.so/23e7809d6a5f47d3bb4a3b97df2e4d56" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>timedCommand4 {
        cmd = &#x27;sleep 5&#x27;
        logfilePath = &#x27;log.out&#x27;
    }
}</span></span></span></code></pre><h2 id="https://www.notion.so/f5014d4075f54418893624d52886e2b3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/f5014d4075f54418893624d52886e2b3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">resources</span></span></h2><div id="https://www.notion.so/941350258091401aa058529a2d2fa9a0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">A </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">resources</code></span><span class="SemanticString"> directory allows the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">libraryResource</code></span><span class="SemanticString"> step to be used from an external library to load associated non-Groovy files. Currently this feature is not supported for internal libraries.</span></span></p></div><pre id="https://www.notion.so/2bc62358e22345e79ec3395a76a3b6d6" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>def request = libraryResource &#x27;com/mycorp/pipeline/somelib/request.json&#x27;</span></span></span></code></pre><div id="https://www.notion.so/14bcd91ad69948e6a87b7c49341f8a79" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The file is loaded as a string, suitable for passing to certain APIs or saving to a workspace using </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">writeFile</code></span><span class="SemanticString">.</span></span></p></div><h2 id="https://www.notion.so/446093c6ac354e5dac6ed07875b679fc" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/446093c6ac354e5dac6ed07875b679fc"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Using Third-Party Libraries</span></span></h2><div id="https://www.notion.so/be8483e56708461f94834eb262f6bb29" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">TBD</span></span></p></div><h1 id="https://www.notion.so/f407e1968fd94d6e837cf7945b3cd675" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/f407e1968fd94d6e837cf7945b3cd675"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Troubleshooting</span></span></h1><h2 id="https://www.notion.so/b3eed7e34b2b48d28b6226dab688fe51" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b3eed7e34b2b48d28b6226dab688fe51"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Replaying External Code and Libraries</span></span></h2><h1 id="https://www.notion.so/0cff9ec0f3fe4c7ca6822a60cd2d9e94" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/0cff9ec0f3fe4c7ca6822a60cd2d9e94"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Sample Library Routine</span></span></h1><h1 id="https://www.notion.so/062009fb3ee14c9b8139615d89ecc35c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/062009fb3ee14c9b8139615d89ecc35c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Summary</span></span></h1><div id="https://www.notion.so/b721d1705ea84c409ab4efed1fdffd9c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">This document provides a comprehensive guide to using shared libraries in Jenkins. It covers the differences between trusted and untrusted libraries, internal and external libraries, and how to load and use libraries in your pipelines. It also includes information on defining global variables and custom steps, and troubleshooting tips.</span></span></p></div><div id="https://www.notion.so/f5e2e35c05e84629a48583adda3b61fc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h1 id="https://www.notion.so/6a51ad6ec6944b6295c955d39fc8a731" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/6a51ad6ec6944b6295c955d39fc8a731"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Reference</span></span></h1><div id="https://www.notion.so/ef8cb19e0fed40afb874a3d515e70969" class="Bookmark"><a href="https://www.jenkins.io/doc/book/pipeline/shared-libraries/"><h5 class="Bookmark__Title">Extending with Shared Libraries</h5><p class="Bookmark__Desc">Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software</p><p class="Bookmark__Link">https://www.jenkins.io/doc/book/pipeline/shared-libraries/</p></a></div><div></div><div id="https://www.notion.so/1af06742f7f44e30b982764b69fb5c6a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <script src="https://utteranc.es/client.js"
        repo="fanxiangs/fanxiangs.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
  <footer class="Footer">
  <div>&copy; CookBook 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>